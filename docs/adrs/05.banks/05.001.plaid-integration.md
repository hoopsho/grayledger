# 05.001. Plaid Integration – The Only Bank Feed Source

**Status:** accepted  
**Date:** 2025-11-19

## Context
99 % of our target users (US-based small businesses) have their primary checking, savings, and credit cards at institutions supported by Plaid.  
We need real transactions flowing into the ledger automatically from day one.

## Decision
- Exclusive use of Plaid (official plaid gem)
- Plaid “Link” flow in a Turbo Frame (no popups, no redirects)
- Only the following Plaid products:
  - Auth (account numbers + routing for verification)
  - Transactions (daily sync + webhooks)
- Development → Sandbox → Production keys in Heroku config vars

### Flow
1. User clicks “Connect Bank” → Turbo Frame opens Plaid Link
2. On success → store encrypted `access_token` on new model `BankConnection`
3. Immediate pull of last 730 days of transactions
4. Daily pull via background job
5. Real-time webhooks for new transactions (instant AI categorization)

### Models
```ruby
class BankConnection < ApplicationRecord
  include BelongsToCompany

  belongs_to :user # who connected it
  encrypts :access_token
  has_many :bank_transactions
end

class BankTransaction < ApplicationRecord
  include BelongsToCompany

  belongs_to :bank_connection
  # fields: plaid_id, posted_at, amount_cents, name, merchant_name, etc.
  enum status: { pending: 0, posted: 1, ignored: 2 }
end
```

### Webhook endpoint
```ruby
# config/routes.rb
post "/plaid/webhook", to: "plaid_webhooks#create"
```

All incoming raw Plaid transactions land as `BankTransaction` records → AI processes them → creates balanced `Entry` if confidence ≥ 95% → else anomaly queue.

## Consequences

- Covers 11,000+ US institutions out of the box
- No MX, no Finicity, no manual CSV hell
- Instant real-time feel (webhooks fire within seconds)
- One dependency, but it's the industry standard and battle-tested

If a user has a bank not supported by Plaid (extremely rare for our segment), they can upload CSV manually — that's the only fallback.
