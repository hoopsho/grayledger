# 10.001. TaxCloud – Server-Side Only, $19/mo, Zero User Visibility

**Status:** accepted  
**Date:** 2025-11-19

## Context
Sales tax is a legal landmine.  
Getting one rate wrong can cost the user thousands in penalties.  
We will never let AI-guess rooftop-accurate rates across 13,000+ jurisdictions.

## Decision
- Exclusive use of TaxCloud (official tax_cloud gem)
- $19/mo flat plan (unlimited transactions, free filing in 24 states, $9 elsewhere)
- Integration is 100 % server-side — users never see TaxCloud, never create an account, never log in anywhere else
- Called only when creating/sending an invoice with a ship-to address
- Rate + tax amount stored on invoice line items for audit trail

### Flow
```ruby
# app/services/sales_tax_calculator.rb
class SalesTaxCalculator
  def call(invoice)
    return Money.zero if invoice.customer.tax_exempt?

    TaxCloud::Transaction.new(
      customer_id: invoice.customer.id,
      origin: TaxCloud::Address.default_origin,
      destination: invoice.shipping_address,
      cart_items: invoice.line_items.map { |li| li.to_tax_cloud_item }
    ).lookup.tax_amount
  end
end
```

### Fallback
If TaxCloud is down (< 0.01% historically), we use the `customer.default_tax_rate` (user can set 0–12%) and flag the invoice for review.

### Nexus monitoring
Monthly job emails user: "You sold $>250k or >200 transactions to Texas – possible nexus" with one-click "Register" link (we pre-fill the state form).

## Consequences

- Perfect rooftop-accurate tax on every invoice
- We eat the $19/mo forever (covered at ~10 paying users)
- Zero liability sits on TaxCloud (they pay your audit fines)
- Users never think about sales tax again
- No Anrok $499/mo insanity

This is the only responsible way to do sales tax in 2025.
